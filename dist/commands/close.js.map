{"version":3,"file":"close.js","sourceRoot":"/","sources":["commands/close.ts"],"names":[],"mappings":";;AAAA,2CAAkF;AAClF,8DAA0D;AAC1D,gDAAwC;AACxC,4CAAqE;AAErE;;;;;EAKE;AAEF,MAAqB,YAAa,SAAQ,uBAAW;IAC7C,MAAM,CAAC,IAAI,GAA6C,IAAI,gCAAmB,EAAE;SACtF,OAAO,CAAC,OAAO,CAAC,CAAC,cAAc,CAAC,kBAAkB,CAAC,CAAC;IACtD,YAAY,MAAsB;QACjC,KAAK,CAAC,MAAM,CAAC,CAAC;IACf,CAAC;IAED,KAAK,CAAC,OAAO,CAAC,WAA+B;QAE5C,yDAAyD;QAEzD,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAC1D,KAAK,EAAE;gBACN,SAAS,EAAE,WAAW,CAAC,OAAO,EAAE,EAAE;aAClC;SACD,CAAC,CAAC;QACH,MAAM,UAAU,GAAG,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAe,CAAC,CAAC,CAAC,SAAS,CAAC;QAElF,IACC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,iBAAiB,KAAK,WAAW;YAChE,CAAE,WAAW,CAAC,MAA6B,EAAE,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,8BAA8B,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC;gBACrI,UAAU,EAAE,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YAEvC,OAAO,WAAW;iBAChB,KAAK,CAAC;gBACN,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,2BAA2B,CAAC;gBAClE,SAAS,EAAE,IAAI;aACf,CAAC;iBACD,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAEhC,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC;YAC9C,IAAA,gCAAc,EAAC,WAAW,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;QAC1C,CAAC;aAAM,CAAC;YACP,MAAM,WAAW,CAAC,UAAU,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;YAC5D,IAAA,gBAAK,EAAC,WAAW,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;QACjC,CAAC;IAAC,CAAC;;AAnCL,+BAoCC;AAED;;;;;EAKE","sourcesContent":["import { CommandInteraction, GuildMember, SlashCommandBuilder } from \"discord.js\";\nimport { closeAskReason } from \"../utils/close_askReason\";\nimport {close} from \"../utils/close.js\";\nimport {BaseCommand, ExtendedClient, TicketType} from \"../structure\";\n\n/*\nCopyright 2023 Sayrix (github.com/Sayrix)\n\nLicensed under the Creative Commons Attribution 4.0 International\nplease check https://creativecommons.org/licenses/by/4.0 for more informations.\n*/\n\nexport default class CloseCommand extends BaseCommand {\n\tpublic static data: SlashCommandBuilder = <SlashCommandBuilder>new SlashCommandBuilder()\n\t\t.setName(\"close\").setDescription(\"Close the ticket\");\n\tconstructor(client: ExtendedClient) {\n\t\tsuper(client);\n\t}\n\n\tasync execute(interaction: CommandInteraction) {\n\t\t\n\t\t// @TODO: Breaking change refactor happens here as well..\n\t\t\n\t\tconst ticket = await this.client.prisma.tickets.findUnique({\n\t\t\twhere: {\n\t\t\t\tchannelid: interaction.channel?.id\n\t\t\t}\n\t\t});\n\t\tconst ticketType = ticket ? JSON.parse(ticket.category) as TicketType : undefined;\n\n\t\tif (\n\t\t\tthis.client.config.closeOption.whoCanCloseTicket === \"STAFFONLY\" &&\n\t\t\t!(interaction.member as GuildMember | null)?.roles.cache.some((r) => this.client.config.rolesWhoHaveAccessToTheTickets.includes(r.id) ||\n\t\t\tticketType?.staffRoles?.includes(r.id))\n\t\t)\n\t\t\treturn interaction\n\t\t\t\t.reply({\n\t\t\t\t\tcontent: this.client.locales.getValue(\"ticketOnlyClosableByStaff\"),\n\t\t\t\t\tephemeral: true,\n\t\t\t\t})\n\t\t\t\t.catch((e) => console.log(e));\n\n\t\tif (this.client.config.closeOption.askReason) {\n\t\t\tcloseAskReason(interaction, this.client);\n\t\t} else {\n\t\t\tawait interaction.deferReply().catch((e) => console.log(e));\n\t\t\tclose(interaction, this.client);\n\t\t}\t}\n}\n\n/*\nCopyright 2023 Sayrix (github.com/Sayrix)\n\nLicensed under the Creative Commons Attribution 4.0 International\nplease check https://creativecommons.org/licenses/by/4.0 for more informations.\n*/\n"]}